<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>新規お申し込み - 九州電力株式会社</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        /* 申込ページ専用スタイル */
        .application-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px;
        }
        
        .application-header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .application-title {
            font-size: 2.2rem;
            color: #007BC2;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .application-subtitle {
            font-size: 1.1rem;
            color: #666;
            margin-bottom: 30px;
        }
        
        /* ステップ進捗バー */
        .progress-container {
            margin-bottom: 40px;
        }
        
        .steps-container {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
        }
        
        .step-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
            position: relative;
        }
        
        .step-item:not(:last-child)::after {
            content: '';
            position: absolute;
            top: 20px;
            left: 50%;
            width: 100%;
            height: 2px;
            background: #e2e8f0;
            z-index: 1;
        }
        
        .step-item.active:not(:last-child)::after {
            background: #007BC2;
        }
        
        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e2e8f0;
            color: #666;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 10px;
            position: relative;
            z-index: 2;
            transition: all 0.3s ease;
        }
        
        .step-item.active .step-number {
            background: #007BC2;
            color: white;
        }
        
        .step-item.completed .step-number {
            background: #10b981;
            color: white;
        }
        
        .step-title {
            font-size: 0.9rem;
            color: #666;
            text-align: center;
            font-weight: 500;
        }
        
        .step-item.active .step-title {
            color: #007BC2;
            font-weight: 600;
        }
        
        .step-item.completed .step-title {
            color: #10b981;
        }
        
        /* フォームステップ */
        .form-step {
            display: none;
            background: white;
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            border: 1px solid #e2e8f0;
        }
        
        .form-step.active {
            display: block;
        }
        
        .step-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .step-header h3 {
            font-size: 1.5rem;
            color: #007BC2;
            margin-bottom: 10px;
        }
        
        .step-header p {
            color: #666;
            font-size: 1rem;
        }
        
        .form-section {
            margin-bottom: 30px;
        }
        
        .form-section h4 {
            font-size: 1.2rem;
            color: #007BC2;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e6f2ff;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group.full-width {
            grid-column: 1 / -1;
        }
        
        .form-label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }
        
        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #007BC2;
            box-shadow: 0 0 0 3px rgba(0, 123, 194, 0.1);
        }
        
        .form-select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            background: white;
            cursor: pointer;
            appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 4 5"><path fill="%23333" d="M2 0L0 2h4zm0 5L0 3h4z"/></svg>');
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 12px;
            padding-right: 40px;
        }
        
        .form-textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
        }
        
        .form-textarea:focus {
            outline: none;
            border-color: #007BC2;
            box-shadow: 0 0 0 3px rgba(0, 123, 194, 0.1);
        }
        
        .required {
            color: #ef4444;
            margin-left: 4px;
        }
        
        .form-actions {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 1px solid #e2e8f0;
        }
        
        .btn-next {
            background: #007BC2;
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-next:hover {
            background: #005A91;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 123, 194, 0.3);
        }
        
        .btn-prev {
            background: transparent;
            color: #007BC2;
            border: 2px solid #007BC2;
            padding: 15px 40px;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-prev:hover {
            background: #007BC2;
            color: white;
        }
        
        .btn-submit {
            background: #10b981;
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-submit:hover {
            background: #059669;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }
        
        .btn-back {
            background: transparent;
            color: #007BC2;
            border: 2px solid #007BC2;
            padding: 15px 40px;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }
        
        .btn-back:hover {
            background: #007BC2;
            color: white;
        }
        
        /* プラン選択カード */
        .plan-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .plan-card {
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }
        
        .plan-card:hover {
            border-color: #007BC2;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 123, 194, 0.1);
        }
        
        .plan-card.selected {
            border-color: #007BC2;
            background: #f8fbff;
        }
        
        .plan-card h4 {
            color: #007BC2;
            font-size: 1.2rem;
            margin-bottom: 10px;
        }
        
        .plan-card p {
            color: #666;
            margin-bottom: 15px;
            line-height: 1.5;
        }
        
        .plan-features {
            list-style: none;
            padding: 0;
            margin-bottom: 15px;
        }
        
        .plan-features li {
            color: #666;
            margin-bottom: 5px;
            padding-left: 20px;
            position: relative;
        }
        
        .plan-features li::before {
            content: '✓';
            position: absolute;
            left: 0;
            color: #10b981;
            font-weight: bold;
        }
        
        .plan-price {
            font-size: 1.1rem;
            font-weight: bold;
            color: #007BC2;
        }
        
        /* 情報表示エリア */
        .info-display {
            background: #f8fbff;
            border: 1px solid #e6f2ff;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .info-display h4 {
            color: #007BC2;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e6f2ff;
        }
        
        .info-item:last-child {
            border-bottom: none;
        }
        
        .info-label {
            font-weight: 600;
            color: #333;
        }
        
        .info-value {
            color: #007BC2;
        }

        /* ラジオボタンとボタンのスタイル */
        .radio-group {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .radio-label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 0.95rem;
        }

        .radio-label input[type="radio"] {
            margin-right: 8px;
            transform: scale(1.2);
        }

        .btn-address-search {
            background: #007BC2;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: background 0.3s ease;
            white-space: nowrap;
        }

        .btn-address-search:hover {
            background: #005A91;
        }

        .btn-add-phone,
        .btn-remove-phone {
            background: #ff9933;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: background 0.3s ease;
            margin: 0 5px;
        }

        .btn-add-phone:hover,
        .btn-remove-phone:hover {
            background: #e68a00;
        }

        .btn-remove-phone {
            background: #666;
        }

        .btn-remove-phone:hover {
            background: #555;
        }

        .result-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            align-items: start;
        }

        .discount-info-container .info-display {
            position: sticky;
            top: 100px;
        }
        
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
                gap: 0;
            }
            
            .form-step {
                padding: 30px 20px;
            }
            
            .application-title {
                font-size: 1.8rem;
            }
            
            .form-actions {
                flex-direction: column;
            }
            
            .plan-cards {
                grid-template-columns: 1fr;
            }

            .result-container {
                grid-template-columns: 1fr;
            }
            
            .steps-container {
                flex-direction: column;
                gap: 20px;
            }
            
            .step-item:not(:last-child)::after {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- ヘッダー -->
    <header class="header">
        <div class="header-container">
            <div class="header-top">
                <div class="logo">
                    <a href="index.html">
                        <img src="九州電力ロゴ.png" alt="九州電力株式会社" class="logo-img">
                    </a>
                </div>
                <div class="header-actions">
                    <div class="utility-nav">
                        <div class="language-selector">
                            <select id="languageSelect">
                                <option value="ja">languages</option>
                                <option value="en">English</option>
                                <option value="ko">한국어</option>
                                <option value="zh">中文</option>
                            </select>
                        </div>
                        <button class="login-btn">My九電ログイン</button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- メインコンテンツ -->
    <main>
        <div class="application-container">
            <!-- 申込ヘッダー -->
            <div class="application-header">
                <h1 class="application-title">新規お申し込み</h1>
                <p class="application-subtitle">電気のご利用開始手続きを行います</p>
            </div>

            <!-- ステップ進捗 -->
            <div class="progress-container">
                <div class="steps-container">
                    <div class="step-item active" id="step1">
                        <div class="step-number">1</div>
                        <div class="step-title">契約プラン設定</div>
                    </div>
                    <div class="step-item" id="step2">
                        <div class="step-number">2</div>
                        <div class="step-title">お客様情報入力</div>
                    </div>
                    <div class="step-item" id="step3">
                        <div class="step-number">3</div>
                        <div class="step-title">利用開始日・支払方法</div>
                    </div>
                </div>
            </div>

            <!-- Step 1: 契約プラン設定 -->
            <div class="form-step active" id="step1Form">
                <div class="step-header">
                    <h3>Step 1: 契約プランおよび付帯契約の設定</h3>
                    <p>ご家族構成や利用状況に基づいて、最適なプランをご提案します</p>
                </div>

                <!-- 事前情報表示（チャットボットからの情報がある場合） -->
                <div class="info-display" id="preInfo" style="display: none;">
                    <h4>📋 チャットボットで確認した情報</h4>
                    <div class="info-grid" id="preInfoGrid">
                        <!-- 動的に情報が表示される -->
                    </div>
                </div>

                <div class="form-section">
                    <h4>ライフスタイルについてお聞かせください</h4>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">家族構成<span class="required">*</span></label>
                            <select class="form-select" id="familyComposition" name="familyComposition" required>
                                <option value="">選択してください</option>
                                <option value="1人">1人</option>
                                <option value="2人">2人</option>
                                <option value="3人">3人</option>
                                <option value="4人">4人</option>
                                <option value="5人以上">5人以上</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">うち、3歳未満のお子様の人数<span class="required">*</span></label>
                            <select class="form-select" id="youngChildren" name="youngChildren" required>
                                <option value="0人">0人</option>
                                <option value="1人">1人</option>
                                <option value="2人">2人</option>
                                <option value="3人以上">3人以上</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">1年以内に九州外から移住<span class="required">*</span></label>
                            <select class="form-select" id="migrated" name="migrated" required>
                                <option value="">選択してください</option>
                                <option value="yes">はい</option>
                                <option value="no">いいえ</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">ご希望のアンペア数<span class="required">*</span></label>
                            <select class="form-select" id="amperage" name="capacity" required>
                                <option value="">選択してください</option>
                                <option value="10">10A（照明、テレビなど最低限）</option>
                                <option value="15">15A（＋PC、電子レンジなど）</option>
                                <option value="20">20A（＋ドライヤー、エアコンなど）</option>
                                <option value="30">30A（＋複数の家電を同時に利用）</option>
                                <option value="40">40A（家族向け。複数のエアコン、調理家電を同時に利用）</option>
                                <option value="50">50A（オール電化や大家族向け）</option>
                                <option value="60">60A（多くの家電を同時に利用）</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">昼間のある程度の利用見込み<small> (ペット,在宅等)</small><span class="required">*</span></label>
                            <select class="form-select" id="daytimeUsage" name="daytimeUsage" required>
                                <option value="">選択してください</option>
                                <option value="yes">ある程度の利用見込みがある</option>
                                <option value="no">昼間はそこまで利用しない</option>
                            </select>
                        </div>
    
                        <div class="form-group">
                            <label class="form-label">お住まいはオール電化<span class="required">*</span></label>
                            <select class="form-select" id="allElectric" name="allElectric" required>
                                <option value="">選択してください</option>
                                <option value="yes">はい</option>
                                <option value="no">いいえ</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">特定設備をお持ちですか？</label>
                            <div id="equipmentCheckboxes" style="padding-top: 5px;">
                                <label style="margin-right: 15px;"><input type="checkbox" name="equipment" value="ecocute"> エコキュート</label>
                                <label style="margin-right: 15px;"><input type="checkbox" name="equipment" value="storage"> 蓄電池</label>
                                <label><input type="checkbox" name="equipment" value="ev"> EV (電気自動車)</label>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">JALマイレージをお得に貯めたいですか？<span class="required">*</span></label>
                            <select class="form-select" id="jalMileage" name="jalMileage" required>
                                <option value="">選択してください</option>
                                <option value="yes">はい</option>
                                <option value="no">いいえ</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-actions" style="border-top: none; padding-top: 10px; justify-content: center;">
                        <button type="button" class="btn-next" style="background-color: #ff9933;" onclick="findPlan()">最適なプランを検索</button>
                    </div>
                </div>

                <div class="form-section" id="planResultSection" style="display: none;">
                    <div class="result-container">
                        <div class="plan-recommendation">
                            <h4>ご提案プラン</h4>
                            <div class="plan-cards" id="planResult">
                                <!-- Results will be injected here -->
                            </div>
                        </div>
                        <div class="discount-info-container">
                             <div id="discountInfo" class="info-display" style="display: none;">
                                <h4>🎉 適用可能な割引プラン</h4>
                                <p id="discountText"></p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="form-section">
                    <h4>付帯契約</h4>
                    <div class="form-group full-width">
                        <label class="form-label">付帯契約</label>
                        <select class="form-select" name="additional">
                            <option value="">なし</option>
                            <option value="notification">使用量通知サービス</option>
                            <option value="eco">省エネアドバイス</option>
                        </select>
                    </div>
                </div>

                <div class="form-actions">
                    <a href="index.html" class="btn-back">戻る</a>
                    <button type="button" class="btn-next" id="step1NextButton" onclick="nextStep()" style="display: none;">次へ進む</button>
                </div>
            </div>

            <!-- Step 2: お客様情報入力 -->
            <div class="form-step" id="step2Form">
                <div class="step-header">
                    <h3>Step 2: お客様情報の入力</h3>
                    <p>申し込みに必要な基本情報をご入力ください</p>
                </div>

                <div class="form-section">
                    <h4>お申込者情報</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">姓<span class="required">*</span></label>
                            <input type="text" class="form-input" name="lastName" placeholder="例：九州" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">名<span class="required">*</span></label>
                            <input type="text" class="form-input" name="firstName" placeholder="例：太郎" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">姓（フリガナ）<span class="required">*</span></label>
                            <input type="text" class="form-input" name="lastNameKana" placeholder="例：キュウシュウ" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">名（フリガナ）<span class="required">*</span></label>
                            <input type="text" class="form-input" name="firstNameKana" placeholder="例：タロウ" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">お申込者と契約名義人の関係<span class="required">*</span></label>
                            <select class="form-select" name="relationship" required>
                                <option value="本人" selected>本人</option>
                                <option value="配偶者">配偶者</option>
                                <option value="家族・親戚">家族・親戚</option>
                                <option value="家主・管理人">家主・管理人</option>
                                <option value="その他">その他</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">メールアドレス<span class="required">*</span></label>
                            <input type="email" class="form-input" name="email" placeholder="例：taro@example.com" required>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h4>住所（ご使用場所）</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">郵便番号<span class="required">*</span></label>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <input type="text" class="form-input" name="postalCode" placeholder="例：810-0001" required style="flex: 1;">
                                <button type="button" class="btn-address-search" onclick="searchAddress()">住所検索</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">都道府県<span class="required">*</span></label>
                            <select class="form-select" name="prefecture" required>
                                <option value="">選択してください</option>
                                <option value="福岡県">福岡県</option>
                                <option value="佐賀県">佐賀県</option>
                                <option value="長崎県">長崎県</option>
                                <option value="熊本県">熊本県</option>
                                <option value="大分県">大分県</option>
                                <option value="宮崎県">宮崎県</option>
                                <option value="鹿児島県">鹿児島県</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">市区町村<span class="required">*</span></label>
                            <input type="text" class="form-input" name="city" placeholder="例：福岡市中央区" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">番地、号<span class="required">*</span></label>
                            <input type="text" class="form-input" name="address1" placeholder="例：渡辺通2丁目1番82号" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">住居タイプ<span class="required">*</span></label>
                            <div class="radio-group">
                                <label class="radio-label">
                                    <input type="radio" name="housingType" value="戸建住宅" required>
                                    <span>戸建住宅</span>
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="housingType" value="集合住宅" required>
                                    <span>集合住宅（マンション・アパート等）</span>
                                </label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">建物名、部屋番号</label>
                            <input type="text" class="form-input" name="address2" placeholder="例：九州電力ビル 101号室">
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h4>連絡先情報</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">ご契約者の電話番号<span class="required">*</span></label>
                            <input type="tel" class="form-input" name="phone1" placeholder="例：092-761-3030" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">電話番号区分<span class="required">*</span></label>
                            <select class="form-select" name="phoneType1" required>
                                <option value="">選択してください</option>
                                <option value="自宅">自宅</option>
                                <option value="携帯">携帯</option>
                                <option value="配偶者">配偶者</option>
                                <option value="家族・親戚">家族・親戚</option>
                                <option value="家主・管理人">家主・管理人</option>
                                <option value="事務所">事務所</option>
                                <option value="その他">その他</option>
                            </select>
                        </div>
                    </div>
                    <div id="phone2Section" style="display: none;">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">電話番号2</label>
                                <input type="tel" class="form-input" name="phone2" placeholder="例：090-1234-5678">
                            </div>
                            <div class="form-group">
                                <label class="form-label">電話番号2区分</label>
                                <select class="form-select" name="phoneType2">
                                    <option value="">選択してください</option>
                                    <option value="自宅">自宅</option>
                                    <option value="携帯">携帯</option>
                                    <option value="配偶者">配偶者</option>
                                    <option value="家族・親戚">家族・親戚</option>
                                    <option value="家主・管理人">家主・管理人</option>
                                    <option value="事務所">事務所</option>
                                    <option value="その他">その他</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="form-group" style="text-align: center; margin-top: 15px;">
                        <button type="button" class="btn-add-phone" id="addPhoneBtn" onclick="addPhone2()">電話番号2を追加</button>
                        <button type="button" class="btn-remove-phone" id="removePhoneBtn" onclick="removePhone2()" style="display: none;">電話番号2を削除</button>
                    </div>
                </div>

                <!-- ガス利用の場合のみ表示される項目 -->
                <div class="form-section" id="gasSection" style="display: none;">
                    <h4>ガス開栓に関する情報</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">ガス使用開始日<span class="required">*</span></label>
                            <input type="date" class="form-input" name="gasStartDate">
                        </div>
                        <div class="form-group">
                            <label class="form-label">立ち合い希望時刻<span class="required">*</span></label>
                            <select class="form-select" name="gasTime">
                                <option value="">選択してください</option>
                                <option value="9:00-12:00">9:00-12:00</option>
                                <option value="13:00-17:00">13:00-17:00</option>
                                <option value="9:00-17:00">9:00-17:00（終日）</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">開栓立会者<span class="required">*</span></label>
                            <select class="form-select" name="gasWitness">
                                <option value="">選択してください</option>
                                <option value="ご契約者">ご契約者</option>
                                <option value="お申込者">お申込者</option>
                                <option value="その他">その他</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">共用玄関や門扉の施錠有無<span class="required">*</span></label>
                            <div class="radio-group">
                                <label class="radio-label">
                                    <input type="radio" name="lockStatus" value="あり">
                                    <span>あり</span>
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="lockStatus" value="なし">
                                    <span>なし</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn-prev" onclick="prevStep()">前へ戻る</button>
                    <button type="button" class="btn-next" onclick="nextStep()">次へ進む</button>
                </div>
            </div>

            <!-- Step 3: 利用開始日・支払方法設定 -->
            <div class="form-step" id="step3Form">
                <div class="step-header">
                    <h3>Step 3: ご利用開始日、支払方法の設定</h3>
                    <p>利用開始日とお支払い方法をご設定ください</p>
                </div>

                <div class="form-section">
                    <h4>利用開始日の設定</h4>
                    <div class="form-group full-width">
                        <label class="form-label">使用開始希望日<span class="required">*</span></label>
                        <input type="date" class="form-input" name="startDate" required>
                    </div>
                    <div class="info-display">
                        <h4>📅 利用開始日について</h4>
                        <p>• 申し込み日から最短で3営業日後から利用開始可能です<br>
                        • 工事が必要な場合は、別途日程調整を行います<br>
                        • 緊急の場合は、お電話でご相談ください（0120-986-807）</p>
                    </div>
                </div>

                <div class="form-section">
                    <h4>支払い方法の設定</h4>
                    <div class="form-group full-width">
                        <label class="form-label">支払い方法<span class="required">*</span></label>
                        <select class="form-select" name="paymentMethod" required>
                            <option value="">選択してください</option>
                            <option value="bank">口座振替（手数料無料）</option>
                            <option value="credit">クレジットカード</option>
                            <option value="convenience">コンビニ払い</option>
                        </select>
                    </div>
                </div>

                <div class="form-section">
                    <h4>備考</h4>
                    <div class="form-group full-width">
                        <label class="form-label">その他ご要望・ご質問</label>
                        <textarea class="form-textarea" name="notes" placeholder="ご要望やご質問がございましたら、お気軽にお書きください。"></textarea>
                    </div>
                </div>

                <!-- 申し込み内容確認 -->
                <div class="info-display">
                    <h4>📋 申し込み内容の確認</h4>
                    <div class="info-grid" id="summaryGrid">
                        <!-- 動的に申し込み内容が表示される -->
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn-prev" onclick="prevStep()">前へ戻る</button>
                    <button type="submit" class="btn-submit" onclick="submitApplication()">申し込みを完了する</button>
                </div>
            </div>
        </div>
    </main>

    <!-- フッター -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>九州電力株式会社</h4>
                    <p>〒810-8720<br>
                    福岡県福岡市中央区渡辺通2丁目1番82号<br>
                    TEL: 092-761-3030</p>
                </div>
                <div class="footer-section">
                    <h4>サポート</h4>
                    <ul class="footer-links">
                        <li><a href="#">よくある質問</a></li>
                        <li><a href="#">お問い合わせ</a></li>
                        <li><a href="#">サイトマップ</a></li>
                        <li><a href="#">プライバシーポリシー</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 九州電力株式会社 All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        let currentStep = 1;
        const totalSteps = 3;
        let applicationData = {};

        const planDetails = {
            smartFamily: {
                name: 'スマートファミリープラン',
                description: 'ご家庭向けの基本的なプラン',
                features: ['時間帯別料金', '使用量に応じた割引', '長期契約割引'],
                price: '使用量に応じて変動'
            },
            nightSelect: {
                name: 'ナイトセレクト',
                description: '夜間の電気使用が多い方向け',
                features: ['夜間料金が割安', 'エコキュート利用者に最適', '生活スタイルに合わせやすい'],
                price: '夜間料金: 22時〜翌8時'
            },
            denkaNightSelect: {
                name: '電化でナイトセレクト',
                description: 'オール電化住宅向けの夜間お得プラン',
                features: ['夜間・休日の料金が割安', 'エコキュートやIHに最適', '電化住宅の光熱費削減'],
                price: '夜間・休日料金がお得'
            },
            ohisamaHiruToku: {
                name: 'おひさま昼トクプラン',
                description: '太陽光発電・蓄電池をお持ちの方向け',
                features: ['昼間の買電がお得', '自家消費をサポート', '環境にやさしい'],
                price: '昼間（10時〜16時）の電気料金がお得'
            },
            jolightB: {
                name: '従量電灯B',
                description: '一般的なご家庭向けの標準プラン',
                features: ['シンプルな料金体系', '3段階料金制', '安定した供給'],
                price: '基本料金: 契約容量×単価'
            },
            jalDenkiB: {
                name: 'JALでんきB',
                description: '電気料金でマイルが貯まるプラン',
                features: ['JALマイルが貯まる', '旅行好きにおすすめ', '従量電灯Bと同じ料金体系'],
                price: '電気料金に応じてマイル付与'
            }
        };

        function findPlan() {
            const familyComp = document.getElementById('familyComposition').value;
            const youngChildren = document.getElementById('youngChildren').value;
            const migrated = document.getElementById('migrated').value;
            const amperage = document.getElementById('amperage').value;
            const daytimeUsage = document.getElementById('daytimeUsage').value;
            const allElectric = document.getElementById('allElectric').value;
            const equipmentCheckboxes = document.querySelectorAll('#equipmentCheckboxes input[name="equipment"]:checked');
            const equipment = Array.from(equipmentCheckboxes).map(cb => cb.value);
            const jalMileage = document.getElementById('jalMileage').value;

            if (!familyComp || !youngChildren || !amperage || !migrated || !daytimeUsage || !allElectric || !jalMileage) {
                alert('すべての項目を選択してください。');
                return;
            }

            const planResultSection = document.getElementById('planResultSection');
            const planResult = document.getElementById('planResult');
            const discountInfo = document.getElementById('discountInfo');
            const discountText = document.getElementById('discountText');
            planResult.innerHTML = '';
            
            let recommendedPlans = new Set();
            let discountMessages = [];

            // Discount logic
            if (youngChildren !== "0人") {
                discountMessages.push('すくすく赤ちゃんプラン（毎月100円割引）');
            }
            if (migrated === 'yes') {
                discountMessages.push('IJUターン応援プラン（毎月200円割引）');
            }
            if (applicationData.gasSet === 'yes') {
                discountMessages.push('<b>ガスセットプラン（毎月300円割引）</b>');
            }

            if (discountMessages.length > 0) {
                discountText.innerHTML = discountMessages.join('<br>');
                discountInfo.style.display = 'block';
            } else {
                discountInfo.style.display = 'none';
            }

            // Plan recommendation logic
            if (allElectric === 'yes') {
                recommendedPlans.add('denkaNightSelect');
                if (equipment.includes('storage') || equipment.includes('ev')) {
                    recommendedPlans.add('ohisamaHiruToku');
                }
            } else {
                if (daytimeUsage === 'no' || equipment.includes('ecocute')) {
                    recommendedPlans.add('nightSelect');
                } else {
                    recommendedPlans.add('smartFamily');
                }
                if (daytimeUsage === 'yes' || equipment.length > 0) {
                    recommendedPlans.add('ohisamaHiruToku');
                }
                recommendedPlans.add('jolightB');
            }
            if (jalMileage === 'yes') {
                recommendedPlans.add('jalDenkiB');
            }
            
            // Create plan cards for recommended plans
            recommendedPlans.forEach(planKey => {
                const plan = planDetails[planKey];
                const card = document.createElement('div');
                card.className = 'plan-card';
                card.setAttribute('data-plan', planKey);
                card.innerHTML = `
                    <h4>${plan.name}</h4>
                    <p>${plan.description}</p>
                    <ul class="plan-features">
                        ${plan.features.map(f => `<li>${f}</li>`).join('')}
                    </ul>
                    <div class="plan-price">${plan.price}</div>
                `;
                card.addEventListener('click', function() {
                    document.querySelectorAll('#planResult .plan-card').forEach(c => c.classList.remove('selected'));
                    this.classList.add('selected');
                    applicationData.plan = this.getAttribute('data-plan');
                    document.getElementById('step1NextButton').style.display = 'inline-block';
                });
                planResult.appendChild(card);
            });
            
            planResultSection.style.display = 'block';
        }

        // ステップ管理
        function showStep(step) {
            // 全てのステップを非表示
            document.querySelectorAll('.form-step').forEach(form => {
                form.classList.remove('active');
            });
            
            // 指定されたステップを表示
            document.getElementById(`step${step}Form`).classList.add('active');
            
            // ステップインジケーターを更新
            updateStepIndicators(step);
        }

        function updateStepIndicators(activeStep) {
            document.querySelectorAll('.step-item').forEach((item, index) => {
                item.classList.remove('active', 'completed');
                if (index + 1 < activeStep) {
                    item.classList.add('completed');
                } else if (index + 1 === activeStep) {
                    item.classList.add('active');
                }
            });
        }

        function nextStep() {
            if (validateCurrentStep()) {
                saveCurrentStepData();
                if (currentStep < totalSteps) {
                    currentStep++;
                    showStep(currentStep);
                    if (currentStep === 3) {
                        updateSummary();
                    }
                }
            }
        }

        function prevStep() {
            if (currentStep > 1) {
                currentStep--;
                showStep(currentStep);
            }
        }

        function validateCurrentStep() {
            const currentForm = document.getElementById(`step${currentStep}Form`);
            const requiredFields = currentForm.querySelectorAll('[required]');
            let isValid = true;

            for (const field of requiredFields) {
                if (!field.value.trim()) {
                    field.style.borderColor = '#ef4444';
                    isValid = false;
                } else {
                    field.style.borderColor = '#e2e8f0';
                }
            }

            if (!isValid) {
                alert('必須項目を入力してください。');
                return false;
            }

            if (currentStep === 1) {
                if (!applicationData.plan) {
                    alert('「最適なプランを検索」ボタンを押し、ご希望のプランを選択してください。');
                    return false;
                }
            }

            return true;
        }

        function saveCurrentStepData() {
            const currentForm = document.getElementById(`step${currentStep}Form`);
            const formData = new FormData(currentForm);
            
            for (let [key, value] of formData.entries()) {
                applicationData[key] = value;
            }
        }

        function updateSummary() {
            const summaryGrid = document.getElementById('summaryGrid');
            summaryGrid.innerHTML = `
                <div class="info-item">
                    <span class="info-label">選択プラン:</span>
                    <span class="info-value">${getPlanName(applicationData.plan)}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">契約容量:</span>
                    <span class="info-value">${applicationData.capacity}A</span>
                </div>
                <div class="info-item">
                    <span class="info-label">家族構成:</span>
                    <span class="info-value">${applicationData.familyComposition}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">3歳未満のお子様:</span>
                    <span class="info-value">${applicationData.youngChildren}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">昼間の電気使用:</span>
                    <span class="info-value">${applicationData.daytimeUsage === 'yes' ? 'あり' : 'なし'}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">お住まいはオール電化:</span>
                    <span class="info-value">${applicationData.allElectric === 'yes' ? 'はい' : 'いいえ'}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">特定設備:</span>
                    <span class="info-value">${applicationData.equipment && applicationData.equipment.length ? applicationData.equipment.join(', ') : 'なし'}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">JALマイレージ希望:</span>
                    <span class="info-value">${applicationData.jalMileage === 'yes' ? 'はい' : 'いいえ'}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">お名前:</span>
                    <span class="info-value">${applicationData.lastName} ${applicationData.firstName}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">メールアドレス:</span>
                    <span class="info-value">${applicationData.email}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">支払い方法:</span>
                    <span class="info-value">${getPaymentMethodName(applicationData.paymentMethod)}</span>
                </div>
            `;
        }

        function getPlanName(plan) {
            return planDetails[plan] ? planDetails[plan].name : '未選択';
        }

        function getPaymentMethodName(method) {
            const methods = {
                'bank': '口座振替',
                'credit': 'クレジットカード',
                'convenience': 'コンビニ払い'
            };
            return methods[method] || '未選択';
        }

        function submitApplication() {
            if (validateCurrentStep()) {
                saveCurrentStepData();
                
                // 送信処理のシミュレーション
                alert('申し込みありがとうございます！\n\n確認メールを1-2営業日以内にお送りいたします。\nご登録いただいたメールアドレスをご確認ください。');
                
                // メインページに戻る
                window.location.href = 'index.html';
            }
        }

        // プラン選択
        document.querySelectorAll('.plan-card').forEach(card => {
            card.addEventListener('click', function() {
                document.querySelectorAll('.plan-card').forEach(c => c.classList.remove('selected'));
                this.classList.add('selected');
                
                // プラン情報を保存
                const plan = this.getAttribute('data-plan');
                const planName = this.querySelector('h4').textContent;
                applicationData.plan = plan;
                applicationData.planName = planName;
            });
        });

        // URLパラメータからチャットボット情報とガスセット情報を取得
        function loadInitialInfo() {
            const urlParams = new URLSearchParams(window.location.search);
            
            // ガスセット割引の処理
            if (urlParams.get('gasSet') === 'true') {
                applicationData.gasSet = 'yes';
            }

            const familySize = urlParams.get('family');
            const usagePattern = urlParams.get('usage');
            const plan = urlParams.get('plan');

            if (familySize || usagePattern || plan) {
                const preInfo = document.getElementById('preInfo');
                const preInfoGrid = document.getElementById('preInfoGrid');
                
                preInfo.style.display = 'block';
                preInfoGrid.innerHTML = '';
                
                if (familySize) {
                    preInfoGrid.innerHTML += `
                        <div class="info-item">
                            <span class="info-label">家族構成:</span>
                            <span class="info-value">${familySize}</span>
                        </div>
                    `;
                }
                
                if (usagePattern) {
                    preInfoGrid.innerHTML += `
                        <div class="info-item">
                            <span class="info-label">使用パターン:</span>
                            <span class="info-value">${usagePattern}</span>
                        </div>
                    `;
                }
                
                if (plan) {
                    preInfoGrid.innerHTML += `
                        <div class="info-item">
                            <span class="info-label">推奨プラン:</span>
                            <span class="info-value">${planDetails[plan] ? planDetails[plan].name : plan}</span>
                        </div>
                    `;
                    
                    // 推奨プランを自動選択（この機能は質問ベースの提案に変更されたため、コメントアウトまたは削除）
                    // const planCard = document.querySelector(`[data-plan="${plan}"]`);
                    // if (planCard) {
                    //     planCard.click();
                    // }
                }
            }
        }

        // 電話番号2の追加・削除機能
        function addPhone2() {
            document.getElementById('phone2Section').style.display = 'block';
            document.getElementById('addPhoneBtn').style.display = 'none';
            document.getElementById('removePhoneBtn').style.display = 'inline-block';
        }

        function removePhone2() {
            document.getElementById('phone2Section').style.display = 'none';
            document.getElementById('addPhoneBtn').style.display = 'inline-block';
            document.getElementById('removePhoneBtn').style.display = 'none';
            // フィールドの値をクリア
            document.querySelector('input[name="phone2"]').value = '';
            document.querySelector('select[name="phoneType2"]').value = '';
        }

        // 住所検索機能（デモ）
        function searchAddress() {
            alert('住所検索機能はデモです。\n実際の運用では郵便番号APIと連携して自動入力されます。');
        }

        // ガスセクションの表示制御
        function toggleGasSection() {
            const gasSection = document.getElementById('gasSection');
            const gasFields = gasSection.querySelectorAll('[required]');
            
            if (applicationData.gasSet === 'yes') {
                gasSection.style.display = 'block';
                // ガス関連フィールドを必須にする
                gasFields.forEach(field => {
                    field.setAttribute('required', 'required');
                });
            } else {
                gasSection.style.display = 'none';
                // ガス関連フィールドの必須属性を削除
                gasFields.forEach(field => {
                    field.removeAttribute('required');
                });
            }
        }

        // ステップ管理を更新（ガスセクションの表示制御を含む）
        function showStep(step) {
            // 全てのステップを非表示
            document.querySelectorAll('.form-step').forEach(form => {
                form.classList.remove('active');
            });
            
            // 指定されたステップを表示
            document.getElementById(`step${step}Form`).classList.add('active');
            
            // Step2の場合、ガスセクションの表示制御
            if (step === 2) {
                toggleGasSection();
            }
            
            // ステップインジケーターを更新
            updateStepIndicators(step);
        }

        // 初期化
        window.addEventListener('load', function() {
            loadInitialInfo();
            showStep(1);
        });
    </script>
</body>
</html>

